<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Leave Requests | Admin Panel</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
/* Reset */
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:'Segoe UI', sans-serif;
}

/* Background */
body{
    min-height:100vh;
    background:linear-gradient(135deg,#020617,#0f172a,#1e293b);
    color:#fff;
}

/* Layout */
.main{
    display:flex;
    min-height:100vh;
}

/* Sidebar */
.sidebar{
    width:260px;
    background:rgba(2,6,23,0.9);
    backdrop-filter:blur(10px);
    padding-top:25px;
}

.logo{
    text-align:center;
    margin-bottom:30px;
}

.logo img{
    width:70px;
    margin-bottom:10px;
}

.logo h2{
    color:#38bdf8;
}

.sidebar a{
    display:flex;
    align-items:center;
    gap:12px;
    padding:15px 22px;
    color:#fff;
    text-decoration:none;
    transition:0.3s;
}

.sidebar a:hover,
.sidebar a.active{
    background:#38bdf8;
    color:#000;
    border-radius:10px;
    margin:0 12px;
}

/* Content */
.content{
    flex:1;
    padding:40px;
}

/* Header */
.header{
    margin-bottom:25px;
}

.header h2{
    color:#38bdf8;
}

/* Card */
.card{
    background:rgba(255,255,255,0.08);
    backdrop-filter:blur(12px);
    border-radius:20px;
    padding:25px;
    box-shadow:0 15px 40px rgba(0,0,0,0.5);
}

/* Table */
table{
    width:100%;
    border-collapse:collapse;
    margin-top:15px;
}

th{
    background:rgba(0,0,0,0.6);
    padding:14px;
    text-transform:uppercase;
    font-size:14px;
}

td{
    padding:14px;
    border-bottom:1px solid rgba(255,255,255,0.1);
}

tr:hover{
    background:rgba(255,255,255,0.05);
}

/* Buttons */
button{
    padding:8px 14px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
    margin:0 5px;
    transition:0.3s;
}

.approve{
    background:#00ff9c;
    color:#000;
}

.approve:hover{
    background:#38bdf8;
    color:#fff;
}

.reject{
    background:#ff4d4d;
    color:#fff;
}

.reject:hover{
    background:#f87171;
    color:#000;
}
</style>
</head>

<body>
  
<div class="main">

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <img src="https://cdn-icons-png.flaticon.com/512/3064/3064197.png" alt="Admin Logo">
            <h2>ADMIN PANEL</h2>
        </div>
        <a href="admin dashboard.html"><i class="fa fa-chart-line"></i> Dashboard</a>
        <a href="leave_request.html" class="active"><i class="fa fa-envelope"></i> Leave Requests</a>
        <a href="employee.html"><i class="fa fa-users"></i> Employees</a>
        <a href="department.html"><i class="fa fa-building"></i> Departments</a>
        <a href="leave_type.html"><i class="fa fa-file-alt"></i> Leave Types</a>
        <a href="admin_attendance.html"><i class="fa fa-clock"></i> Attendance</a>
    </div>

    <!-- Content -->
    <div class="content">
        <div class="header">
            <h2>ðŸ“© Leave Requests</h2>
        </div>

        <div class="card">
            <table>
    <thead>
        <tr>
            <th>Employee</th>
            <th>Type</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody id="leaveTable"></tbody>
</table>

               
        </div>

    </div>


<script>
/* REPLACE THE SCRIPT IN leave_request.html WITH THIS */
function loadLeaves() {
    const table = document.getElementById("leaveTable");
    const leaves = JSON.parse(localStorage.getItem("leaveRequests")) || [];
    
    // Clear current table content
    table.innerHTML = "";

    // Filter for only pending requests
    const pendingLeaves = leaves.filter(l => l.status === "Pending");

    if (pendingLeaves.length === 0) {
        table.innerHTML = `<tr><td colspan="3" style="text-align:center;opacity:0.6;">No pending leave requests</td></tr>`;
        return;
    }

    pendingLeaves.forEach((leave) => {
        table.innerHTML += `
        <tr>
            <td>
                <strong>${leave.employee}</strong><br>
                <small style="opacity:0.7">${leave.from} to ${leave.to}</small>
            </td>
            <td>${leave.type}</td>
            <td>
                <button class="approve" onclick="updateStatus(${leave.id}, 'Approved')">
                    <i class="fa fa-check"></i> Approve
                </button>
                <button class="reject" onclick="updateStatus(${leave.id}, 'Rejected')">
                    <i class="fa fa-times"></i> Reject
                </button>
            </td>
        </tr>`;
    });
}

function updateStatus(leaveId, newStatus) {
    let leaves = JSON.parse(localStorage.getItem("leaveRequests")) || [];
    
    // Find the specific leave by ID and update it
    // We use String() to ensure we are comparing text to text, avoiding type errors
    leaves = leaves.map(leave => {
        if (String(leave.id) === String(leaveId)) {
            leave.status = newStatus;
        }
        return leave;
    });

    localStorage.setItem("leaveRequests", JSON.stringify(leaves));
    
    // Provide feedback and refresh list
    alert(`Leave request has been ${newStatus}.`);
    loadLeaves();
}

// Initial Load
document.addEventListener("DOMContentLoaded", loadLeaves);
</script>
</div>
</body>