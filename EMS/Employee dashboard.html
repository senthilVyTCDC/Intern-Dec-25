<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Dashboard</title>
    <link rel="stylesheet" href="Employee dashboard.css">
    <style>
        /* New styles to remain consistent with your existing design */
        .attendance-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .clock-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: white;
        }
        .clock-in { background-color: #28a745; }
        .clock-out { background-color: #dc3545; }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        
        .announcement-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 5px solid #00d2ff;
        }
        
        .holiday-list {
            list-style: none;
            padding: 0;
        }
        .holiday-item {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        @media (max-width: 768px) {
            .dashboard-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>

<body>

<div class="topbar">
    <div><b>Employee MS</b></div>
    <div>
        Welcome : <span id="empName">Employee</span>
        | <a href="#" onclick="logout()" style="color:white;">Logout</a>
    </div>
</div>

<div class="main">
    <div class="sidebar">
        <a href="Employee dashboard.html">ğŸ  Dashboard</a>
        <a href="profile.html">ğŸ‘¤ My Profile</a>
        <a href="apply leave.html">âœ Apply Leave</a>
        <a href="leave status.html">ğŸ“… Leave Status</a>
        <a href="salary.html">ğŸ’° Salary</a>
        <a href="attendance.html">ğŸ“Š Attendance</a>
        <a href="change_password.html">ğŸ” Change Password</a>
    </div>

    <div class="content">
        <div class="page-title">ğŸ‘¤ Employee Dashboard</div>

        <div class="attendance-box">
            <div>
                <h3 id="currentTime">00:00:00 AM</h3>
                <p id="currentDate">Loading Date...</p>
            </div>
            <div>
                <button id="clockBtn" class="clock-btn clock-in" onclick="toggleClock()">Clock In</button>
            </div>
        </div>

        <div class="cards">
            <div class="card green"><b>Total Leaves</b><br><br><span id="total">12</span></div>
            <div class="card yellow"><b>Leaves Used</b><br><br><span id="used">0</span></div>
            <div class="card teal"><b>Remaining</b><br><br><span id="remaining">12</span></div>
            <div class="card red"><b>Pending</b><br><br><span id="pending">0</span></div>
        </div>

        <div class="dashboard-grid">
            <div class="table-box">
                <b>ğŸ“‹ Recent Leave Status</b><br><br>
                <table id="dashTable">
                    <tr>
                        <th>Leave Type</th>
                        <th>From</th>
                        <th>To</th>
                        <th>Status</th>
                    </tr>
                    </table>
            </div>

            <div class="table-box">
                <b>ğŸ“¢ Announcements</b>
                <div class="announcement-box" style="margin-top:10px;">
                    <small>Jan 20, 2025</small>
                    <p>New Health Insurance Policy updated in the Salary section.</p>
                </div>

                <b style="display:block; margin-top:20px;">ğŸ—“ Upcoming Holidays</b>
                <ul class="holiday-list">
                    <li class="holiday-item">Republic Day - Jan 26</li>
                    <li class="holiday-item">Holi - Mar 14</li>
                </ul>
            </div>
        </div>

        <div class="actions">
            <a href="apply leave.html" class="action-link">ğŸ“ Apply Leave</a>
            <a href="profile.html" class="action-link">ğŸ‘¤ Profile</a>
            <a href="salary details.html" class="action-link">ğŸ’° Salary Slip</a>
        </div>
    </div>
</div>

<script>
    // 1. INITIALIZE DATA
    const employeeName = localStorage.getItem("employeeName") || "John";
    document.getElementById("empName").innerText = employeeName;

    // 2. LIVE CLOCK LOGIC
    // This function runs every 1 second to update the display
    function updateLiveClock() {
        const now = new Date();
        const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        const dateString = now.toDateString();
        
        // Updates the HTML elements
        document.getElementById("currentTime").innerText = timeString;
        document.getElementById("currentDate").innerText = dateString;
    }
    
    // Start the clock timer
    setInterval(updateLiveClock, 1000);
    updateLiveClock(); // Run immediately on load

    // 3. CLOCK IN / OUT BUTTON LOGIC
    let isClockedIn = false; // Initial state

    function toggleClock() {
        const btn = document.getElementById("clockBtn");
        const now = new Date();
        const timeStamp = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        const dateStamp = now.toDateString();

        // Get existing logs or start new array
        let logs = JSON.parse(localStorage.getItem("attendanceLogs")) || [];
        let todayLog = logs.find(log => log.date === dateStamp);

        if (!isClockedIn) {
            // ACTION: CLOCK IN
            isClockedIn = true;
            btn.innerText = "Clock Out";
            btn.className = "clock-btn clock-out"; // Switch to red button
            
            // Save to LocalStorage for the Attendance Page
            if (!todayLog) {
                logs.push({ date: dateStamp, in: timeStamp, out: null });
            }
            alert("Clocked in successfully at " + timeStamp);
        } else {
            // ACTION: CLOCK OUT
            isClockedIn = false;
            btn.innerText = "Clock In";
            btn.className = "clock-btn clock-in"; // Switch back to green button
            
            if (todayLog) {
                todayLog.out = timeStamp;
            }
            alert("Clocked out successfully at " + timeStamp);
        }

        // Save the updated list back to the browser memory
        localStorage.setItem("attendanceLogs", JSON.stringify(logs));
    }

    // 4. LOAD DASHBOARD DATA (Leaves & Summary)
    function loadDashboardData() {
        const leaves = JSON.parse(localStorage.getItem("leaveRequests")) || [];
        const myLeaves = leaves.filter(l => l.employee === employeeName);
        
        // Update summary cards
        const used = myLeaves.filter(l => l.status === "Approved").length;
        document.getElementById("used").innerText = used;
        document.getElementById("pending").innerText = myLeaves.filter(l => l.status === "Pending").length;
        document.getElementById("remaining").innerText = 12 - used;

        // Update Table
        const tableBody = document.querySelector(".table-box table");
        tableBody.innerHTML = `<tr><th>Leave Type</th><th>From</th><th>To</th><th>Status</th></tr>`;
        
        myLeaves.slice(-3).reverse().forEach(leave => {
            tableBody.innerHTML += `
                <tr>
                    <td>${leave.type}</td>
                    <td>${leave.from}</td>
                    <td>${leave.to}</td>
                    <td class="${leave.status.toLowerCase()}">${leave.status}</td>
                </tr>`;
        });
    }

    function logout() {
        localStorage.clear();
        window.location.href = "login.html";
    }

    document.addEventListener("DOMContentLoaded", loadDashboardData);
</script>
</body>
</html>